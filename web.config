<?xml version="1.0" encoding="UTF-8"?>
<configuration>
  <system.webServer>
    <handlers>
      <add name="httpPlatformHandler" path="*" verb="*" modules="httpPlatformHandler" resourceType="Unspecified" />
    </handlers>
    <!-- 
      startupTimeLimit: Time to wait for the process to start (seconds)
      startupRetryCount: Number of times to retry starting the process
      stdoutLogEnabled: Save console output to file (useful for debugging)
    -->
    <httpPlatform 
      processPath="C:\Program Files\nodejs\npm.cmd" 
      arguments="start" 
      startupTimeLimit="60" 
      startupRetryCount="3" 
      stdoutLogEnabled="true" 
      stdoutLogFile=".\logs\stdout.log">
      <environmentVariables>
        <!-- Ensure PORT is passed to Next.js by IIS -->
        <environmentVariable name="PORT" value="%HTTP_PLATFORM_PORT%" />
        <environmentVariable name="NODE_ENV" value="production" />
      </environmentVariables>
    </httpPlatform>
  </system.webServer>
</configuration>